# 更新日志

本项目的所有重要变更都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [1.0.0] - 2025-10-06

### 新增 ✨

#### 核心功能
- 完整的数据清洗管线，支持从原始 Google Sheet 到清洗层 Google Sheet 的自动化清洗
- 可配置的清洗规则（通过 `config/config.json` 管理）
- 人名别名映射功能，支持多对一映射（中文名/英文名/昵称 → 统一 ID）
- 数据校验功能，生成详细的错误和警告报告
- Dry-run 模式，支持先预览后写入

#### 清洗规则
- 日期标准化（支持多种格式输入，统一输出 YYYY-MM-DD）
- 文本清理（去除空格、全角空格、占位符处理）
- 经文引用标准化
- 歌曲拆分与去重（支持多种分隔符）
- 列合并功能（如合并多个敬拜同工列）
- 服务周数自动计算（ISO 周数）

#### 模块
- `gsheet_utils.py`: Google Sheets API 封装
- `cleaning_rules.py`: 清洗规则实现
- `alias_utils.py`: 别名映射工具
- `validators.py`: 数据校验器
- `clean_pipeline.py`: 主清洗管线

#### 工具和脚本
- `run_pipeline.sh`: 便捷执行脚本，支持参数解析和环境检查
- 完整的单元测试套件（`tests/test_cleaning.py`）
- 样例数据（`tests/sample_raw.csv`, `tests/sample_aliases.csv`）

#### 文档
- 完整的用户指南（`README.md`）
- 快速上手指南（`QUICKSTART.md`）
- 项目概览文档（`PROJECT_OVERVIEW.md`）
- 任务说明文档（`prompts/README_prompt.md`）
- 示例配置文件（`config/config.example.json`）

#### 输出
- CSV 预览文件
- JSON 预览文件
- 详细的校验报告（保存到 `logs/`）
- 控制台摘要输出

### 安全 🔒
- 最小权限原则（原始表只读、清洗表只写）
- 服务账号认证
- 敏感信息保护（`.gitignore` 配置）
- 日志不打印敏感令牌

### 测试 🧪
- 单元测试覆盖所有核心功能
- 日期清洗测试
- 别名映射测试
- 歌曲拆分测试
- 列合并测试
- 数据校验测试
- 完整管线测试

---

## 未来计划 🚀

### [1.1.0] - 计划中

#### 新增
- [ ] 增量清洗功能（只处理新增或修改的数据）
- [ ] 支持更多日期格式
- [ ] 自定义校验规则配置
- [ ] 数据去重逻辑

#### 改进
- [ ] 性能优化（大数据集处理）
- [ ] 更详细的进度显示
- [ ] 更友好的错误提示

### [2.0.0] - 计划中

#### 新增
- [ ] Web UI 界面
- [ ] 实时清洗（监听原始表变化）
- [ ] 多层清洗支持（原始层 → 清洗层 → 服务层）
- [ ] 数据统计分析功能
- [ ] 集成到 Airflow/Prefect 调度系统

---

## 版本说明

### 版本号格式：主版本号.次版本号.修订号

- **主版本号（Major）**：不兼容的 API 变更
- **次版本号（Minor）**：向下兼容的功能新增
- **修订号（Patch）**：向下兼容的问题修复

### 变更类型

- **新增（Added）**：新功能
- **变更（Changed）**：现有功能的变更
- **废弃（Deprecated）**：即将移除的功能
- **移除（Removed）**：已移除的功能
- **修复（Fixed）**：问题修复
- **安全（Security）**：安全相关的变更


