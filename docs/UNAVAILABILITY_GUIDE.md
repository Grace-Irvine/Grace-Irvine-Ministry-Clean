# åŒå·¥ä¸å¯ç”¨æ—¶é—´æ ‡æ³¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•åœ¨ `VolunteerMetadata` Google Sheet ä¸­æ­£ç¡®æ ‡æ³¨åŒå·¥çš„ä¸å¯ç”¨æ—¶é—´ï¼Œä»¥ä¾¿ç³»ç»Ÿèƒ½å¤Ÿåœ¨æ’ç­å»ºè®®å’Œå†²çªæ£€æµ‹ä¸­åšå‡ºæ­£ç¡®çš„è°ƒæ•´ã€‚

---

## ğŸ¯ ä¸¤ç§ä¸å¯ç”¨æƒ…å†µ

### æƒ…å†µ1ï¼šä¸´æ—¶ä¸å¯ç”¨ï¼ˆæœ‰æ˜ç¡®ç»“æŸæ—¥æœŸï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- çŸ­æœŸæ—…è¡Œ
- å‚åŠ åŸ¹è®­
- ä¸´æ—¶å‡ºå·®
- çŸ­æœŸç”Ÿç—…
- ç‰¹å®šæ—¶é—´æ®µçš„ä¸ªäººå®‰æ’

**æ ‡æ³¨æ–¹æ³•**ï¼šå¡«å†™æ˜ç¡®çš„å¼€å§‹å’Œç»“æŸæ—¥æœŸ

**ç¤ºä¾‹**ï¼š

```
person_id          | person_name | unavailable_start | unavailable_end | unavailable_reason        | notes
-------------------|-------------|-------------------|-----------------|---------------------------|------------------
person_8101_è°¢è‹—   | è°¢è‹—        | 2025-11-01        | 2025-11-15      | æ—…è¡Œ                      | 
person_3850_é–é“®   | é–é“®        | 2025-12-20        | 2025-12-31      | å›å›½æ¢äº²                  |
person_6745_æ˜æ˜   | æ˜æ˜        | 2025-10-15        | 2025-10-22      | å‡ºå·®                      |
person_noah        | Noah        | 2025-11-08        | 2025-11-10      | å‚åŠ å©šç¤¼                  |
```

**ç³»ç»Ÿè¡Œä¸º**ï¼š
- âœ… åœ¨ä¸å¯ç”¨æœŸé—´ï¼Œè¯¥åŒå·¥ä¸ä¼šå‡ºç°åœ¨æ’ç­å»ºè®®ä¸­
- âœ… å¦‚æœå·²æ’ç­ï¼Œå†²çªæ£€æµ‹ä¼šæ ‡è®°ä¸º `error` çº§åˆ«å†²çª
- âœ… æœŸé™è¿‡åï¼Œè‡ªåŠ¨æ¢å¤å¯ç”¨çŠ¶æ€

---

### æƒ…å†µ2ï¼šé•¿æœŸ/æ— é™æœŸä¸å¯ç”¨

**é€‚ç”¨åœºæ™¯**ï¼š
- é•¿æœŸç”Ÿç—…ä¼‘å…»
- æš‚åœæœä¾ï¼ˆæ¢å¤æ—¶é—´æœªå®šï¼‰
- é€€å‡ºæœä¾å›¢é˜Ÿ
- äº§å‡/é™ªäº§å‡
- é•¿æœŸå‡ºå›½
- å·¥ä½œ/å­¦ä¸šç¹å¿™ï¼ˆæš‚åœæœä¾ï¼‰

**æ ‡æ³¨æ–¹æ³•**ï¼šä½¿ç”¨è¿œæœŸæ—¥æœŸï¼ˆæ¨è `2099-12-31`ï¼‰

**ç¤ºä¾‹**ï¼š

```
person_id          | person_name | unavailable_start | unavailable_end | unavailable_reason        | notes
-------------------|-------------|-------------------|-----------------|---------------------------|------------------
person_6878_æœå¾·åŒ | æœå¾·åŒ      | 2025-10-01        | 2099-12-31      | é•¿æœŸä¼‘æ¯                  | å·¥ä½œç¹å¿™ï¼Œæš‚åœæœä¾
person_2165_å•æ™“ç‡• | å•æ™“ç‡•      | 2025-09-15        | 2099-12-31      | äº§å‡                      | é¢„äº§æœŸ11æœˆï¼Œå…·ä½“æ¢å¤æ—¶é—´å¾…å®š
person_7865_ä½•å‡¯   | ä½•å‡¯        | 2025-08-01        | 2099-12-31      | é€€å‡ºæœä¾                  | å·²ä¸åœ¨æœ¬æ•™ä¼š
person_0464_è”¡æ©å¥‡ | è”¡æ©å¥‡      | 2025-10-10        | 2099-12-31      | èº«ä½“åŸå›                   | é•¿æœŸä¼‘å…»
```

**ç³»ç»Ÿè¡Œä¸º**ï¼š
- âœ… è¯¥åŒå·¥ä¸ä¼šå‡ºç°åœ¨æ’ç­å»ºè®®ä¸­
- âœ… å¦‚æœå·²æ’ç­ï¼Œå†²çªæ£€æµ‹ä¼šæ ‡è®°ä¸º `error` çº§åˆ«å†²çª
- âœ… åœ¨ metadata API ä¸­æ˜¾ç¤ºä¸º `is_available: false`
- âœ… æ˜ç¡®å‘ŠçŸ¥ LLM è¯¥åŒå·¥å½“å‰ä¸å¯ç”¨

**æ¢å¤æœä¾æ—¶**ï¼š
åªéœ€æ›´æ–° `unavailable_end` ä¸ºå®é™…çš„æ¢å¤æ—¥æœŸï¼Œæˆ–è€…æ¸…ç©ºè¯¥å­—æ®µ

---

## ğŸ“Š æ•°æ®æ ¼å¼è¯´æ˜

### å­—æ®µå®šä¹‰

| å­—æ®µ | ç±»å‹ | å¿…å¡« | æ ¼å¼ | è¯´æ˜ |
|------|------|------|------|------|
| `person_id` | å­—ç¬¦ä¸² | âœ… æ˜¯ | `person_xxxx_å§“å` | åŒå·¥å”¯ä¸€æ ‡è¯† |
| `person_name` | å­—ç¬¦ä¸² | âœ… æ˜¯ | ä¸­æ–‡å§“å | æ˜¾ç¤ºåç§° |
| `unavailable_start` | æ—¥æœŸ | âŒ å¦ | `YYYY-MM-DD` | ä¸å¯ç”¨å¼€å§‹æ—¥æœŸ |
| `unavailable_end` | æ—¥æœŸ | âŒ å¦ | `YYYY-MM-DD` | ä¸å¯ç”¨ç»“æŸæ—¥æœŸ |
| `unavailable_reason` | å­—ç¬¦ä¸² | âŒ å¦ | ç®€çŸ­è¯´æ˜ | ä¸å¯ç”¨åŸå›  |
| `notes` | å­—ç¬¦ä¸² | âŒ å¦ | è¯¦ç»†è¯´æ˜ | å…¶ä»–å¤‡æ³¨ä¿¡æ¯ |

### æ—¥æœŸæ ¼å¼è¦æ±‚

**æ­£ç¡®æ ¼å¼**ï¼š
- âœ… `2025-11-01`
- âœ… `2025-12-25`
- âœ… `2099-12-31` ï¼ˆç”¨äºé•¿æœŸä¸å¯ç”¨ï¼‰

**é”™è¯¯æ ¼å¼**ï¼š
- âŒ `11/01/2025`
- âŒ `2025/11/01`
- âŒ `æ°¸ä¹…` æˆ– `æ— é™æœŸ`ï¼ˆä¸èƒ½ç”¨æ–‡å­—ï¼‰

---

## ğŸ” ç³»ç»Ÿå¦‚ä½•è¯†åˆ«ä¸å¯ç”¨çŠ¶æ€

### API å“åº”ç¤ºä¾‹

#### 1. ä¸´æ—¶ä¸å¯ç”¨çš„åŒå·¥

```json
{
  "person_id": "person_8101_è°¢è‹—",
  "person_name": "è°¢è‹—",
  "unavailable_start": "2025-11-01",
  "unavailable_end": "2025-11-15",
  "unavailable_reason": "æ—…è¡Œ",
  "is_available": false,  // â† å½“å‰ä¸å¯ç”¨
  "notes": ""
}
```

#### 2. é•¿æœŸä¸å¯ç”¨çš„åŒå·¥

```json
{
  "person_id": "person_6878_æœå¾·åŒ",
  "person_name": "æœå¾·åŒ",
  "unavailable_start": "2025-10-01",
  "unavailable_end": "2099-12-31",
  "unavailable_reason": "é•¿æœŸä¼‘æ¯",
  "is_available": false,  // â† é•¿æœŸä¸å¯ç”¨
  "notes": "å·¥ä½œç¹å¿™ï¼Œæš‚åœæœä¾"
}
```

#### 3. å¯ç”¨çš„åŒå·¥

```json
{
  "person_id": "person_3850_é–é“®",
  "person_name": "é–é“®",
  "unavailable_start": "",
  "unavailable_end": "",
  "unavailable_reason": "",
  "is_available": true,   // â† å¯ç”¨
  "notes": ""
}
```

---

## ğŸ¤– æ’ç­å»ºè®®ç®—æ³•çš„å¤„ç†

### è¯„åˆ†ç³»ç»Ÿ

å½“ LLM è¯·æ±‚æ’ç­å»ºè®®æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š

1. **æ£€æŸ¥æ—¶é—´å¯ç”¨æ€§**ï¼ˆ`consider_availability: true`ï¼‰
   ```python
   if is_date_in_range(service_date, unavailable_start, unavailable_end):
       score -= 100  # ä¸å¯ç”¨ï¼Œç›´æ¥æ’é™¤
       concerns.append(f"æ—¶é—´ä¸å¯ç”¨ï¼ˆ{unavailable_reason}ï¼‰")
   ```

2. **è¿”å›å»ºè®®æ—¶æ’é™¤ä¸å¯ç”¨åŒå·¥**
   - åˆ†æ•° â‰¤ 0 çš„å€™é€‰äººä¸ä¼šå‡ºç°åœ¨å»ºè®®åˆ—è¡¨ä¸­
   - LLM åªä¼šçœ‹åˆ°å¯ç”¨çš„åŒå·¥

### ç¤ºä¾‹ï¼šæ’ç­å»ºè®®è¯·æ±‚

**è¯·æ±‚**ï¼š
```json
{
  "service_date": "2025-11-10",
  "required_roles": ["éŸ³æ§", "å¸ç´"],
  "consider_availability": true,
  "consider_family": true,
  "consider_balance": true
}
```

**å“åº”**ï¼ˆå·²è‡ªåŠ¨æ’é™¤ 11æœˆæ—…è¡Œçš„è°¢è‹—ï¼‰ï¼š
```json
{
  "suggestions": [
    {
      "role": "éŸ³æ§",
      "candidates": [
        {
          "person_id": "person_6745_æ˜æ˜",
          "person_name": "æ˜æ˜",
          "score": 90,
          "reasons": [
            "æ—¶é—´å¯ç”¨",
            "æ— å®¶åº­æˆå‘˜å†²çª",
            "æœä¾æ¬¡æ•°é€‚ä¸­ï¼ˆ6æ¬¡ï¼‰"
          ],
          "concerns": []
        }
      ]
    }
  ]
}
```

---

## âš ï¸ å†²çªæ£€æµ‹

### ä¸å¯ç”¨æ—¶é—´å†²çª

å¦‚æœæŸä¸ªåŒå·¥åœ¨ä¸å¯ç”¨æœŸé—´è¢«å®‰æ’æœä¾ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ï¼š

**å†²çªç¤ºä¾‹**ï¼š
```json
{
  "type": "unavailability_conflict",
  "severity": "error",
  "week": "2025-11-10",
  "description": "è°¢è‹— åœ¨ 2025-11-01 åˆ° 2025-11-15 æœŸé—´ä¸å¯ç”¨ï¼Œä½†è¢«å®‰æ’æœä¾",
  "affected_persons": [
    {
      "person_id": "person_8101_è°¢è‹—",
      "person_name": "è°¢è‹—",
      "role": "éŸ³æ§",
      "service_date": "2025-11-10"
    }
  ],
  "unavailable_reason": "æ—…è¡Œ",
  "suggestion": "éœ€è¦é‡æ–°å®‰æ’å…¶ä»–äºº"
}
```

---

## ğŸ“ å®é™…æ“ä½œæ­¥éª¤

### æ­¥éª¤1ï¼šæ‰“å¼€ Google Sheets

```
https://docs.google.com/spreadsheets/d/1ypiXsdrfOrWxsAVJxQfZVwA0qtzRzb-siGiV2vixuoc/edit
```

æ‰¾åˆ° `VolunteerMetadata` sheet

### æ­¥éª¤2ï¼šæ‰¾åˆ°å¯¹åº”çš„åŒå·¥è¡Œ

ä½¿ç”¨ `Ctrl+F`ï¼ˆWindowsï¼‰æˆ– `Cmd+F`ï¼ˆMacï¼‰æœç´¢åŒå·¥å§“å

### æ­¥éª¤3ï¼šå¡«å†™ä¸å¯ç”¨ä¿¡æ¯

#### ä¸´æ—¶ä¸å¯ç”¨ç¤ºä¾‹ï¼š
| unavailable_start | unavailable_end | unavailable_reason | notes |
|-------------------|-----------------|---------------------|-------|
| 2025-11-01 | 2025-11-15 | æ—…è¡Œ | |

#### é•¿æœŸä¸å¯ç”¨ç¤ºä¾‹ï¼š
| unavailable_start | unavailable_end | unavailable_reason | notes |
|-------------------|-----------------|---------------------|-------|
| 2025-10-01 | 2099-12-31 | é•¿æœŸä¼‘æ¯ | å·¥ä½œç¹å¿™ï¼Œæš‚åœæœä¾ |

### æ­¥éª¤4ï¼šéªŒè¯æ•°æ®

ä½¿ç”¨ API éªŒè¯ï¼š
```bash
curl "http://localhost:8080/api/v1/volunteer/metadata?person_id=person_8101_è°¢è‹—" | jq '.volunteers[0].is_available'
```

åº”è¯¥è¿”å› `false`

---

## ğŸ”„ å¸¸è§åœºæ™¯å¤„ç†

### åœºæ™¯1ï¼šåŒå·¥æå‰é€šçŸ¥ä¸‹æœˆä¸èƒ½æœä¾

**å¤„ç†**ï¼š
1. åœ¨ Google Sheets ä¸­æ‰¾åˆ°è¯¥åŒå·¥
2. å¡«å†™ `unavailable_start` å’Œ `unavailable_end`
3. å¡«å†™ `unavailable_reason`ï¼ˆå¦‚"æ—…è¡Œ"ï¼‰
4. è¿è¡Œå†²çªæ£€æµ‹ï¼Œæ£€æŸ¥æ˜¯å¦å·²å®‰æ’
   ```bash
   curl -X POST http://localhost:8080/api/v1/volunteer/conflicts \
     -H "Content-Type: application/json" \
     -d '{"year_month": "2025-11", "check_availability": true}'
   ```

### åœºæ™¯2ï¼šåŒå·¥çªç„¶ç”Ÿç—…ï¼Œéœ€è¦é•¿æœŸä¼‘æ¯

**å¤„ç†**ï¼š
1. è®¾ç½® `unavailable_start` ä¸ºå½“å‰æ—¥æœŸ
2. è®¾ç½® `unavailable_end` ä¸º `2099-12-31`
3. å¡«å†™ `unavailable_reason`ï¼ˆå¦‚"èº«ä½“åŸå› "ï¼‰
4. åœ¨ `notes` ä¸­æ·»åŠ è¯¦ç»†è¯´æ˜
5. æ£€æµ‹å†²çªå¹¶é‡æ–°å®‰æ’

### åœºæ™¯3ï¼šåŒå·¥ä¼‘æ¯åæ¢å¤æœä¾

**å¤„ç†æ–¹æ³•1**ï¼ˆæ¨èï¼‰ï¼š
- æ›´æ–° `unavailable_end` ä¸ºå®é™…æ¢å¤æ—¥æœŸ
- ä¾‹å¦‚ï¼šä» `2099-12-31` æ”¹ä¸º `2025-12-15`

**å¤„ç†æ–¹æ³•2**ï¼š
- æ¸…ç©º `unavailable_start` å’Œ `unavailable_end`
- æ¸…ç©º `unavailable_reason`
- åœ¨ `notes` ä¸­è®°å½•æ¢å¤æ—¶é—´

### åœºæ™¯4ï¼šåŒå·¥å¤šä¸ªæ—¶é—´æ®µä¸å¯ç”¨

**æ–¹æ³•1**ï¼ˆæ¨èï¼‰ï¼šåªå¡«å†™æœ€è¿‘/æœ€é•¿çš„ä¸å¯ç”¨æœŸ
```
unavailable_start: 2025-11-01
unavailable_end: 2025-11-15
unavailable_reason: æ—…è¡Œ
notes: å¦å¤–12æœˆ20-25æ—¥ä¹Ÿä¸å¯ç”¨ï¼ˆåœ£è¯èŠ‚ï¼‰
```

**æ–¹æ³•2**ï¼šä½¿ç”¨è„šæœ¬æ·»åŠ å¤šæ¡è®°å½•ï¼ˆé«˜çº§ç”¨æ³•ï¼‰
```bash
# æ·»åŠ ç¬¬ä¸€ä¸ªä¸å¯ç”¨æœŸ
curl -X POST http://localhost:8080/api/v1/volunteer/metadata \
  -d '{"person_id": "person_8101_è°¢è‹—", ...}'

# éœ€è¦åç»­å®ç°å¤šæ—¶é—´æ®µæ”¯æŒ
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **åŠæ—¶æ›´æ–°**: åŒå·¥é€šçŸ¥ä¸å¯ç”¨æ—¶é—´åï¼Œç«‹å³æ›´æ–° metadata
2. **æ˜ç¡®åŸå› **: å¡«å†™æ¸…æ™°çš„ `unavailable_reason`ï¼Œä¾¿äºåç»­æŸ¥è¯¢
3. **ä½¿ç”¨å¤‡æ³¨**: åœ¨ `notes` ä¸­æ·»åŠ è¯¦ç»†è¯´æ˜å’Œæ¢å¤è®¡åˆ’
4. **å®šæœŸæ£€æŸ¥**: æ¯æœˆæ£€æŸ¥é•¿æœŸä¸å¯ç”¨çš„åŒå·¥ï¼Œæ›´æ–°æ¢å¤æ—¥æœŸ
5. **è¿è¡Œå†²çªæ£€æµ‹**: æ›´æ–°åç«‹å³è¿è¡Œå†²çªæ£€æµ‹

### âŒ é¿å…åšæ³•

1. âŒ ä¸è¦ä½¿ç”¨æ–‡å­—è¡¨ç¤ºæ—¥æœŸï¼ˆå¦‚"ä¸‹å‘¨"ã€"æ°¸ä¹…"ï¼‰
2. âŒ ä¸è¦ç•™ç©º `unavailable_reason`
3. âŒ ä¸è¦å¿˜è®°æ›´æ–°æ¢å¤åçš„çŠ¶æ€
4. âŒ ä¸è¦ç›´æ¥åˆ é™¤åŒå·¥è®°å½•ï¼ˆåº”è¯¥æ ‡è®°ä¸ºä¸å¯ç”¨ï¼‰

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•1ï¼šéªŒè¯ä¸å¯ç”¨çŠ¶æ€

```bash
# è·å–æ‰€æœ‰ä¸å¯ç”¨çš„åŒå·¥
curl "http://localhost:8080/api/v1/volunteer/metadata" | \
  jq '.volunteers[] | select(.is_available == false) | {person_name, unavailable_reason}'
```

### æµ‹è¯•2ï¼šéªŒè¯æ’ç­å»ºè®®å·²æ’é™¤

```bash
# è¯·æ±‚æ’ç­å»ºè®®
curl -X POST http://localhost:8080/api/v1/volunteer/suggestions \
  -H "Content-Type: application/json" \
  -d '{
    "service_date": "2025-11-10",
    "required_roles": ["éŸ³æ§"],
    "consider_availability": true
  }' | jq '.suggestions[0].candidates[] | .person_name'

# ä¸åº”è¯¥å‡ºç°ä¸å¯ç”¨çš„åŒå·¥
```

### æµ‹è¯•3ï¼šéªŒè¯å†²çªæ£€æµ‹

```bash
# æ£€æµ‹å†²çª
curl -X POST http://localhost:8080/api/v1/volunteer/conflicts \
  -H "Content-Type: application/json" \
  -d '{"year_month": "2025-11", "check_availability": true}' | \
  jq '.conflicts[] | select(.type == "unavailability_conflict")'
```

---

## ğŸ“ LLM ä½¿ç”¨æŒ‡å—

å½“æ‚¨ï¼ˆLLMï¼‰éœ€è¦ä¸ºæ•™ä¼šå®‰æ’åŒå·¥æœä¾æ—¶ï¼š

### 1. æŸ¥è¯¢å½“å‰å¯ç”¨çš„åŒå·¥
```bash
GET /api/v1/volunteer/metadata
```
å…³æ³¨ `is_available` å­—æ®µ

### 2. è·å–æ’ç­å»ºè®®æ—¶
```bash
POST /api/v1/volunteer/suggestions
```
**åŠ¡å¿…è®¾ç½®**ï¼š
```json
{
  "consider_availability": true  // â† è¿™ä¼šè‡ªåŠ¨æ’é™¤ä¸å¯ç”¨åŒå·¥
}
```

### 3. è§£è¯»å“åº”
- `is_available: false` â†’ è¯¥åŒå·¥å½“å‰ä¸å¯ç”¨ï¼Œä¸è¦æ¨è
- `concerns` åŒ…å« "æ—¶é—´ä¸å¯ç”¨" â†’ è¯¥åŒå·¥åœ¨æŒ‡å®šæ—¥æœŸä¸å¯ç”¨
- `score <= 0` â†’ è¯¥å€™é€‰äººå·²è¢«è‡ªåŠ¨æ’é™¤

### 4. å‘ç”¨æˆ·è§£é‡Š
```
ä¾‹å¦‚ï¼š
"è°¢è‹—åœ¨ 11æœˆ1æ—¥è‡³15æ—¥æœŸé—´æ—…è¡Œï¼Œå› æ­¤æœ¬æ¬¡æ’ç­å»ºè®®ä¸­æ²¡æœ‰åŒ…å«ä»–ã€‚
æ¨èä½¿ç”¨æ˜æ˜ï¼ˆåˆ†æ•°90ï¼‰æ‹…ä»»éŸ³æ§ï¼Œå› ä¸ºä»–æ—¶é—´å¯ç”¨ä¸”æœä¾æ¬¡æ•°é€‚ä¸­ã€‚"
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- API æ–‡æ¡£: `docs/API_ENDPOINTS.md`
- è®¾ç½®æŒ‡å—: `VOLUNTEER_METADATA_SETUP_GUIDE.md`
- å®Œæ•´æŠ¥å‘Š: `VOLUNTEER_METADATA_FINAL_REPORT.md`

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-07

